<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบแจ้งเตือนวันนัดคดี</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <style>
        body { background-color: #f0f2f5; }
    </style>
</head>
<body>

    <div class="container mt-4">
        <h1 class="mb-4">รายการนัดคดีสำคัญ</h1>
        <div id="case-container" class="row gy-4"></div>
    </div>

    <script>
        // Check if the browser supports Service Workers
        if ('serviceWorker' in navigator) {
        // Register our service worker file
        navigator.serviceWorker.register('sw.js')
            .then(registration => {
            console.log('Service Worker registered with scope:', registration.scope);
            })
            .catch(error => {
            console.error('Service Worker registration failed:', error);
            });
        }
        // 1. จำลองการรับข้อมูล JSON จาก API (ตอนนี้เป็นแค่ตัวแปร String)
        const jsonData = `
        [
            { "caseNumber": "อ.123/2568", "charge": "ฉ้อโกง", "purpose": "นัดสืบพยานโจทก์", "room": "801", "date": "2025-10-21", "time": "09:30" },
            { "caseNumber": "พ.456/2568", "charge": "ละเมิดลิขสิทธิ์", "purpose": "นัดไต่สวนมูลฟ้อง", "room": "704", "date": "2025-10-21", "time": "13:30" },
            { "caseNumber": "อ.789/2568", "charge": "ทำร้ายร่างกาย", "purpose": "นัดฟังคำพิพากษา", "room": "809", "date": "2025-10-23", "time": "10:00" },
            { "caseNumber": "ภ.101/2568", "charge": "ยาเสพติด", "purpose": "นัดสืบพยานจำเลย", "room": "602", "date": "2025-10-23", "time": "14:00" },
            { "caseNumber": "อ.112/2568", "charge": "ลักทรัพย์", "purpose": "นัดสืบพยานโจทก์", "room": "801", "date": "2025-10-23", "time": "09:30" }
        ]
        `;

        // 2. แปลง JSON String ให้กลายเป็น JavaScript Array ที่ใช้งานได้
        const cases = JSON.parse(jsonData);

        // 3. ส่วนที่เหลือของโค้ดเหมือนเดิมทุกอย่าง!
        const container = document.getElementById('case-container');
        cases.forEach(caseData => {
            const cardHtml = `
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">${caseData.caseNumber}</h5>
                            <h6 class="card-subtitle mb-2 text-muted">${caseData.charge}</h6>
                            <p class="card-text mb-1"><strong>นัดเพื่อ:</strong> ${caseData.purpose}</p>
                            <p class="card-text"><strong>วันที่:</strong> ${caseData.date} <strong>เวลา:</strong> ${caseData.time} <strong>ห้อง:</strong> ${caseData.room}</p>
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML += cardHtml;
        });
        // 1. ขออนุญาตแสดง Notification เมื่อแอปโหลด
        document.addEventListener('DOMContentLoaded', () => {
            if ('Notification' in window) {
                Notification.requestPermission();
            }
        });

        // 2. ฟังก์ชันสำหรับแสดงการแจ้งเตือนและเล่นเสียง
        // In index.html, inside the <script> tag

        function showNotificationWithSound(title, bodyText) {
            if (Notification.permission === 'granted') {
                
                const options = {
                    body: bodyText,
                    icon: 'images/icons/icon-192x192.png',
                    // Add this line for vibration!
                    vibrate: [200, 100, 200] // Vibrate 200ms, pause 100ms, vibrate 200ms
                };

                const notification = new Notification(title, options);

                // Sound will likely only play on desktop, but we can leave it.
                const audio = new Audio('assets/sounds/notification.mp3'); 
                audio.play().catch(e => console.error("Autoplay was blocked", e));
            }
        }

        // 3. ตัวอย่างการเรียกใช้งาน (ลองใส่ไว้ล่างสุดเพื่อทดสอบ)
        // ใช้ setTimeout เพื่อหน่วงเวลา 5 วินาทีหลังเปิดหน้าเว็บ
        setTimeout(() => {
            showNotificationWithSound(
                'ทดสอบการแจ้งเตือน',
                'นี่คือการแจ้งเตือนพร้อมเสียง!'
            );
        }, 5000);
    </script>

</body>
</html>